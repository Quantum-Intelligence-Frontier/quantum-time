<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8. Delayed Choice and Quantum Eraser: How Later Choices Determine Present Statistics ‚Äì Quantum Time &amp; History</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f507c7d0488cb7630e20aad62ad8c2aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>window.MathJax = {loader: {load: ['[tex]/boldsymbol']},tex: {packages: {'[+]': ['boldsymbol']}}};</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html">Chapters</a></li><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 8. Natural Selection and Quantum Eraser.html">8. Natural Selection and Quantum Eraser</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">English</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Language</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index_en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">English</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ÌïúÍµ≠Ïñ¥</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/0. Table of Contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table of Contents</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Hilbert Space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 2. Coupling and State of Quantum Systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Coupling and State of Quantum Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 3. Symmetry Group and Generator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Symmetry Group and Generator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 4. Action Functional and Variational Euler-Lagrange Equation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Action</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 5. Path Integral Axiomatization Functional Integral Symbol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Path Integral</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 6. Dynamics of Open Quantum Systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Dynamics of Open Quantum Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 7. Consistency_History and Quantum_Probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Consistency History</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 8. Natural Selection and Quantum Eraser.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">8. Natural Selection and Quantum Eraser</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 9. Quantum Pluralism How is Objective Reality Born?.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Quantum Pluralism</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 10. Emergent Time - Flow of Time in a Frozen Universe Page-Wootters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Emergent Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 11. C-von_Neumann_Operator_Algebra_Thermal_Time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Thermal_Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 12. Uncertain Causal Order.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Uncertain Causal Order</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 13. Regge-Garg Inequality - Hidden Quantumness in Time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Regge-Garg Inequality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/14. Appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Appendix</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fundamental-concepts" id="toc-fundamental-concepts" class="nav-link active" data-scroll-target="#fundamental-concepts">1. Fundamental Concepts</a></li>
  <li><a href="#symbols-and-key-relations" id="toc-symbols-and-key-relations" class="nav-link" data-scroll-target="#symbols-and-key-relations">2. Symbols and Key Relations</a></li>
  <li><a href="#examples-with-deeper-insight" id="toc-examples-with-deeper-insight" class="nav-link" data-scroll-target="#examples-with-deeper-insight">3. Examples with Deeper Insight</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">4. Exercises</a></li>
  <li><a href="#explanation" id="toc-explanation" class="nav-link" data-scroll-target="#explanation">5. Explanation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html">Chapters</a></li><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 8. Natural Selection and Quantum Eraser.html">8. Natural Selection and Quantum Eraser</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">8. Delayed Choice and Quantum Eraser: How Later Choices Determine Present Statistics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>One of the core principles of quantum mechanics, <strong>Complementarity</strong>, states that we cannot simultaneously know the <strong>particle-like properties</strong> (e.g., which path was taken?) and <strong>wave-like properties</strong> (e.g., interference pattern between paths) of a system perfectly. <strong>Delayed Choice</strong> and <strong>Quantum Eraser</strong> experiments are thought experiments and actual experiments that dramatically illustrate this principle. These experiments show that even if we perform a measurement to determine whether it is ‚Äúwave-like‚Äù or ‚Äúparticle-like‚Äù <strong>much later</strong> than the point at which we would expect the object (e.g., a photon) to have already ‚Äúcompleted‚Äù its choice, the results appear as if we had set that configuration from the beginning.</p>
<section id="fundamental-concepts" class="level3">
<h3 class="anchored" data-anchor-id="fundamental-concepts">1. Fundamental Concepts</h3>
<ul>
<li><p><strong>Wheeler‚Äôs Delayed Choice</strong>: An experiment where, after a photon has already entered an interferometer (e.g., Mach-Zehnder), we decide whether to observe an interference pattern (wave-like property) or determine the path (particle-like property).</p>
<blockquote class="blockquote">
<p><strong>Detailed Explanation: The Analogy of a Traveler at a Crossroads ‚úàÔ∏è</strong></p>
<p>Imagine a traveler (photon) departing from an airport (BS1) and boarding a flight to one of two routes (Path 1, Path 2).</p>
<ol type="1">
<li><strong>Path Measurement (Particle)</strong>: If we separate the arrival airports into two (D1, D2), the traveler arrives at either D1 or D2. We can 100% know whether they came via Path 1 or Path 2.</li>
<li><strong>Interference Measurement (Wave)</strong>: If we merge the two paths into a single ‚Äúconverging terminal‚Äù (BS2) just before arrival, travelers from both paths interfere with each other. Depending on the weather (phase difference), all travelers might end up going only to D1 or only to D2 (interference pattern).</li>
</ol>
<p><strong>Key Insight of Delayed Choice</strong>: Even if we decide whether to install this ‚Äúconverging terminal (BS2)‚Äù after the traveler is already in flight (after passing through BS1), the result remains the same. If we install the terminal (later choice), an interference pattern appears; if we remove it (later choice), path statistics emerge. This suggests that the photon does not pre-commit to being a ‚Äúparticle‚Äù or a ‚Äúwave.‚Äù</p>
</blockquote></li>
<li><p><strong>Quantum Eraser</strong>: A technique where we intentionally erase interference patterns by attaching a <strong>‚Äúmarker‚Äù</strong> that reveals the particle‚Äôs path, and later selectively restore the interference pattern by <strong>‚Äúerasing‚Äù</strong> that marker information through measurement.</p>
<blockquote class="blockquote">
<p><strong>Detailed Explanation: Double Slit and Polarizing Glasses üï∂Ô∏è</strong></p>
<ol type="1">
<li><strong>Interference Erasure</strong>: In the double-slit experiment, place a vertical polarizer (<span class="math inline">\(|V\rangle\)</span>) at slit 1 and a horizontal polarizer (<span class="math inline">\(|H\rangle\)</span>) at slit 2. Now, by simply observing the polarization of a photon arriving at the screen, we can 100% determine which slit it passed through (<span class="math inline">\(|V\rangle \perp |H\rangle\)</span>). In this way, when path information (particle-like property) is perfectly known, the interference pattern (wave-like property) completely disappears due to the principle of complementarity.</li>
<li><strong>Information Erasure</strong>: Place a 45-degree polarizer (<span class="math inline">\(|D\rangle\)</span>) in front of the screen. Photons passing through this polarizer become 45-degree polarized regardless of whether they came from <span class="math inline">\(|V\rangle\)</span> or <span class="math inline">\(|H\rangle\)</span>. Thus, the original path information (<span class="math inline">\(|V\rangle\)</span> or <span class="math inline">\(|H\rangle\)</span>) is erased.</li>
<li><strong>Interference Restoration</strong>: Remarkably, when we collect only the photons that passed through the 45-degree polarizer, their distribution on the screen again shows an interference pattern! Photons that did not pass through the 45-degree polarizer (i.e., those that passed through the 135-degree polarizer) show a different interference pattern (with the opposite phase). Complementarity and Information**: The clarity (visibility, <span class="math inline">\(V\)</span>) of the interference pattern and our ability to distinguish the path (distinguishability, <span class="math inline">\(D\)</span>) are related by the complementary relation <span class="math inline">\(V^2 + D^2 \le 1\)</span>. The quantum eraser demonstrates that in the <span class="math inline">\(D=1, V=0\)</span> state, by performing an ‚Äòerasure‚Äô measurement, it selects a subset where <span class="math inline">\(D &lt; 1\)</span>, thereby showing that <span class="math inline">\(V &gt; 0\)</span>.</li>
</ol>
</blockquote></li>
</ul>
<hr>
</section>
<section id="symbols-and-key-relations" class="level3">
<h3 class="anchored" data-anchor-id="symbols-and-key-relations">2. Symbols and Key Relations</h3>
<ul>
<li><p><strong>Interference Amplitude</strong>: The amplitude of a system passing through two paths <span class="math inline">\(\psi_1, \psi_2\)</span> is <span class="math inline">\(\mathcal{A} = \psi_1 + \psi_2\)</span>. The detection probability (intensity) is <span class="math inline">\(I \propto |\psi_1 + \psi_2|^2 = |\psi_1|^2 + |\psi_2|^2 + 2\text{Re}(\psi_1^* \psi_2)\)</span>.</p></li>
<li><p><strong>Which-Path Marking</strong>: If the path information is stored in a marker state <span class="math inline">\(|m_p\rangle\)</span>, the total state becomes an entangled state: <span class="math inline">\(|\Psi\rangle = \psi_1(x) |m_1\rangle + \psi_2(x) |m_2\rangle\)</span> In this case, the detection probability (intensity) ignoring the marker at the screen <span class="math inline">\(x\)</span> is: <span class="math inline">\(I(x) \propto |\psi_1(x)|^2 + |\psi_2(x)|^2 + 2\text{Re}(\langle m_1|m_2\rangle \psi_1^*(x)\psi_2(x))\)</span></p>
<ul>
<li><span class="math inline">\(\mu = \langle m_1|m_2\rangle\)</span> is the inner product (overlap) of the marker states.</li>
<li>If the marker is perfectly distinguishable (<span class="math inline">\(|m_1\rangle \perp |m_2\rangle\)</span>), <span class="math inline">\(\mu = 0\)</span>, and the interference term (<span class="math inline">\(2\text{Re}(\dots)\)</span>) disappears.</li>
</ul></li>
<li><p><strong>Quantum Erasure (Conditional Erasure)</strong>: When the marker state is measured (projected) into the ‚Äòerasure basis‚Äô <span class="math inline">\(|e\rangle\)</span>, the conditional probability of finding the system at <span class="math inline">\(x\)</span> is: <span class="math inline">\(P(x | e) = |\langle x| \langle e | \Psi \rangle|^2 = |\psi_1(x)\langle e|m_1\rangle + \psi_2(x)\langle e|m_2\rangle|^2\)</span></p>
<ul>
<li>If the erasure state <span class="math inline">\(|e\rangle\)</span> is chosen such that <span class="math inline">\(\langle e|m_1\rangle = \langle e|m_2\rangle \neq 0\)</span> (e.g., <span class="math inline">\(|e\rangle = \frac{1}{\sqrt{2}}(|m_1\rangle + |m_2\rangle)\)</span>), the interference term is perfectly restored into the form <span class="math inline">\(\psi_1^*\psi_2\)</span>.</li>
</ul></li>
<li><p><strong>No Retrocausality</strong>:</p>
<blockquote class="blockquote">
<p><strong>üí° Does a later choice change the past? (No!)</strong></p>
<p>It is easy to misunderstand delayed-choice or quantum erasure as implying that a future measurement changes a past event (whether the photon was a particle or a wave). This is not true.</p>
<ul>
<li><strong>Overall statistics are invariant</strong>: Whether or not we use an ‚Äòerasure‚Äô measurement, the <em>total</em> distribution of photons accumulated on the screen is always the one without interference fringes (the state with path information).</li>
<li><strong>Conditional selection</strong>: The ‚Äòerasure‚Äô measurement is a post-selection process that selects only the data among the photons that have already reached the screen, satisfying a specific condition (e.g., passing through a 45¬∞ polarizer).</li>
</ul>
<p>In other words, a later choice does not change the past physical reality, but rather determines which <em>statistical subset</em> we observe. It is like an encrypted message that remains unchanged, but only a specific key (the erasure measurement) allows us to decode it.</p>
</blockquote></li>
</ul>
<hr>
</section>
<section id="examples-with-deeper-insight" class="level3">
<h3 class="anchored" data-anchor-id="examples-with-deeper-insight">3. Examples with Deeper Insight</h3>
<ul>
<li><strong>Example A1: Mach-Zehnder Interferometer</strong>
<ul>
<li><strong>BS2 Removed (Particle Path)</strong>: The photons that pass through the first beam splitter (BS1) definitely follow path 1 or 2. Path 1 goes to detector D1, and path 2 goes to detector D2. Even when changing <span class="math inline">\(\Delta\phi\)</span>, the probabilities for D1 and D2 remain constant at 50:50. <span class="math inline">\(\to\)</span> <strong>Path Determination (Which-Path)</strong>.</li>
<li><strong>BS2 Inserted (Wave Interference)</strong>: The second beam splitter (BS2) recombines the two paths. Depending on the phase difference <span class="math inline">\(\Delta\phi\)</span> between the two paths, interference fringes appear at D1 as <span class="math inline">\(I \propto \cos^2(\Delta\phi/2)\)</span> (constructive/destructive interference), and at D2 as <span class="math inline">\(I \propto \sin^2(\Delta\phi/2)\)</span>. <span class="math inline">\(\to\)</span> <strong>Interference (Wave-like)</strong>.</li>
</ul></li>
<li><strong>Example A2: Double Slit and Polarization Tagging</strong>
<ul>
<li><strong>Tagging (Interference Suppression)</strong>: Slit 1 <span class="math inline">\(\to |H\rangle\)</span> polarization, Slit 2 <span class="math inline">\(\to |V\rangle\)</span> polarization. Since <span class="math inline">\(\langle H|V\rangle = 0\)</span>, interference disappears. Two single-slit fringes overlap on the screen.</li>
<li><strong>Erasing (Interference Restoration)</strong>: Measurement is performed with a 45-degree (<span class="math inline">\(|D\rangle\)</span>) polarizer in front of the screen.
<ul>
<li>Conditional probability <span class="math inline">\(P(x|D) \propto |\psi_1(x)\langle D|H\rangle + \psi_2(x)\langle D|V\rangle|^2 = |\frac{1}{\sqrt{2}}\psi_1(x) + \frac{1}{\sqrt{2}}\psi_2(x)|^2\)</span>. The interference fringes of <span class="math inline">\(\psi_1\)</span> and <span class="math inline">\(\psi_2\)</span> are restored.</li>
<li>If measured with a 135-degree (<span class="math inline">\(|A\rangle\)</span>) polarizer, <span class="math inline">\(P(x|A) \propto |\frac{1}{\sqrt{2}}\psi_1(x) - \frac{1}{\sqrt{2}}\psi_2(x)|^2\)</span>. Interference fringes with opposite phase are restored.</li>
</ul></li>
</ul></li>
<li><strong>Example B1: Delayed-Choice Quantum Eraser Using Entanglement</strong>
<ul>
<li><strong>Setup</strong>: An entangled photon pair (Signal, Idler) is generated.</li>
<li><strong>Signal</strong>: Passes through a double slit and is recorded on a screen (D0). (Attempt to create interference fringes)</li>
<li><strong>Tagging (Idler)</strong>: The Idler photon‚Äôs path is set to depend on which slit the Signal photon passed through (i.e., the Idler acquires ‚Äúpath information‚Äù).</li>
<li><strong>Delayed Choice</strong>: After the Signal photon has reached D0, we decide the measurement method for the Idler photon.
<ol type="1">
<li><strong>Path Reading</strong>: Measure which path the Idler came from (D1 or D2).</li>
<li><strong>Path Erasing</strong>: Combine the two paths of the Idler using a beam splitter (BS) and measure (D3 or D4).</li>
</ol></li>
<li><strong>Result</strong>: The entire data recorded on D0 shows no interference fringes. However, when selecting data under the condition ‚ÄúIdler detected at D3‚Äù, interference fringes appear, and when selecting under the condition ‚ÄúIdler detected at D1‚Äù, no interference fringes appear.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">4. Exercises</h3>
<ol type="1">
<li><strong>Visibility and Marker Inner Product</strong>: Show that when two paths (<span class="math inline">\(\psi_1, \psi_2\)</span>) are entangled with marker states (<span class="math inline">\(|m_1\rangle, |m_2\rangle\)</span>), the total intensity <span class="math inline">\(I(x)\)</span> at screen <span class="math inline">\(x\)</span> takes the form <span class="math inline">\(I(x) \propto |\psi_1(x)|^2 + |\psi_2(x)|^2 + 2\text{Re}(\mu \psi_1^*(x)\psi_2(x))\)</span>, where <span class="math inline">\(\mu = \langle m_1|m_2\rangle\)</span>. Why does interference vanish when <span class="math inline">\(\mu=0\)</span>?</li>
<li><strong>Conditional Interference Restoration</strong>: Explain what conditions <span class="math inline">\(\langle e|m_1\rangle\)</span> and <span class="math inline">\(\langle e|m_2\rangle\)</span> must satisfy for the interference term to be restored in the conditional intensity <span class="math inline">\(I(x|e)\)</span> when conditioned on the marker analyzer state <span class="math inline">\(|e\rangle\)</span> in a quantum eraser.</li>
<li><strong>Mach-Zehnder Transition Amplitude</strong>: Using the transition matrices of a 50:50 beam splitter and mirrors, calculate the probabilities of detection at each of the two detectors both when and when the final beam splitter (BS2) is present, as functions of the phase difference <span class="math inline">\(\Delta\phi\)</span>.</li>
<li><strong>Delayed Choice and Causality</strong>: Logically explain why a ‚Äúlater decision‚Äù does not alter the past, from the perspective of the invariance of conditional statistics and the overall joint distribution.</li>
<li><strong>Complementarity Relation</strong>: Summarize how Bohr‚Äôs complementarity principle (the arrangement of measurement devices exclusively reveals either wave or particle behavior) is consistent with the results of delayed-choice and quantum eraser experiments.</li>
</ol>
<hr>
</section>
<section id="explanation" class="level3">
<h3 class="anchored" data-anchor-id="explanation">5. Explanation</h3>
<ol type="1">
<li>The total state is <span class="math inline">\(|\Psi\rangle = \psi_1(x)|m_1\rangle + \psi_2(x)|m_2\rangle\)</span>. The probability density at the screen <span class="math inline">\(x\)</span> is the diagonal component of the density matrix <span class="math inline">\(\rho_S(x) = \text{Tr}_m(|\Psi\rangle\langle\Psi|)\)</span>, which is obtained by taking the partial trace over the marker state. <span class="math inline">\(\rho_S(x) = |\psi_1(x)|^2 |m_1\rangle\langle m_1| + |\psi_2(x)|^2 |m_2\rangle\langle m_2| + \psi_1(x)\psi_2^*(x) |m_1\rangle\langle m_2| + \dots\)</span> <span class="math inline">\(I(x) = \langle x|\text{Tr}_m(\rho_S(x))|x\rangle\)</span> ‚Ä¶ (this derivation is complex). Easier method: <span class="math inline">\(I(x) = \text{Tr}(\hat{P}_x |\Psi\rangle\langle\Psi|) = \langle\Psi|\hat{P}_x|\Psi\rangle = ( \psi_1^*\langle m_1| + \psi_2^*\langle m_2| ) (\psi_1|m_1\rangle + \psi_2|m_2\rangle) = |\psi_1|^2\langle m_1|m_1\rangle + |\psi_2|^2\langle m_2|m_2\rangle + \psi_1^*\psi_2 \langle m_1|m_2\rangle + \psi_2^*\psi_1 \langle m_2|m_1\rangle\)</span>. Assuming <span class="math inline">\(|m_p\rangle\)</span> is normalized (<span class="math inline">\(\langle m_p|m_p\rangle=1\)</span>), <span class="math inline">\(I(x) \propto |\psi_1|^2 + |\psi_2|^2 + 2\text{Re}(\mu \psi_1^*\psi_2)\)</span> where <span class="math inline">\(\mu=0\)</span> (orthogonal markers), the <span class="math inline">\(\psi_1^*\psi_2\)</span> term becomes zero and interference disappears.</li>
<li><span class="math inline">\(I(x|e) \propto |\psi_1(x)\langle e|m_1\rangle + \psi_2(x)\langle e|m_2\rangle|^2\)</span>. The interference term is <span class="math inline">\(2\text{Re}(\psi_1^*\psi_2 \langle m_1|e\rangle \langle e|m_2\rangle)\)</span>. For this term to survive, both <span class="math inline">\(\langle e|m_1\rangle\)</span> and <span class="math inline">\(\langle e|m_2\rangle\)</span> must be non-zero. For maximum interference, <span class="math inline">\(|\langle e|m_1\rangle| = |\langle e|m_2\rangle|\)</span> must hold.</li>
<li>BS matrix <span class="math inline">\(U_{BS} = \frac{1}{\sqrt{2}}\begin{pmatrix} 1 &amp; i \\ i &amp; 1 \end{pmatrix}\)</span>, mirror <span class="math inline">\(U_M = \begin{pmatrix} 0 &amp; 1 \\ 1 &amp; 0 \end{pmatrix}\)</span>, phase <span class="math inline">\(U_\phi = \begin{pmatrix} e^{i\phi_1} &amp; 0 \\ 0 &amp; e^{i\phi_2} \end{pmatrix}\)</span>.
<ul>
<li>Removing BS2: D1 probability is only path 1, D2 probability is only path 2. Each is 50% (independent of phase difference).</li>
<li>Inserting BS2: Calculating <span class="math inline">\(U_{BS} U_\phi U_{BS} |0\rangle\)</span>, D1 probability is <span class="math inline">\(\cos^2(\Delta\phi/2)\)</span>, D2 probability is <span class="math inline">\(\sin^2(\Delta\phi/2)\)</span> (<span class="math inline">\(\Delta\phi = \phi_2-\phi_1+\pi/2\)</span> etc.) and interference appears.</li>
</ul></li>
<li>In delayed-choice, ‚ÄòBS2 insertion‚Äô and ‚ÄòBS2 removal‚Äô represent different experimental setups. The <em>total</em> data distribution obtained in each setup is different. In quantum erasure, the <em>total</em> data (including all idler measurement results) always shows the same (non-interfering) distribution, regardless of the ‚Äòerasure‚Äô setting. The ‚Äòerasure‚Äô measurement merely provides a later criterion for classifying a specific subset of the total data, without altering already recorded individual photon data. Therefore, there is no retrocausality.</li>
<li>Bohr‚Äôs complementarity seems contradictory when clinging to the classical picture of ‚Äòwave‚Äô and ‚Äòparticle‚Äô. However, delayed-choice/erasure experiments show that the ‚Äúoverall setup (context)‚Äù of the measurement device determines the ‚Äústatistical phenomenon‚Äù we ultimately obtain. The setup inserting BS2 is designed to produce ‚Äòinterference statistics‚Äô, while the setup removing BS2 is designed to produce ‚Äòpath statistics‚Äô. What the photon was when passing through BS1 is not important; the entire experimental setup (light source, BS1, path, BS2/erasure, detector) as an integrated system determines the final statistics, fully consistent with complementarity.</li>
<li>The total state is <span class="math inline">\(|\Psi\rangle = \psi_1(x)|m_1\rangle + \psi_2(x)|m_2\rangle\)</span>. The probability density at screen <span class="math inline">\(x\)</span> is the diagonal components of the density matrix <span class="math inline">\(\rho_S(x) = \text{Tr}_m(|\Psi\rangle\langle\Psi|)\)</span>, which is obtained by tracing out the marker state. <span class="math inline">\(\rho_S(x) = |\psi_1(x)|^2 |m_1\rangle\langle m_1| + |\psi_2(x)|^2 |m_2\rangle\langle m_2| + \psi_1(x)\psi_2^*(x) |m_1\rangle\langle m_2| + \dots\)</span> <span class="math inline">\(I(x) = \langle x|\text{Tr}_m(\rho_S(x))|x\rangle\)</span> ‚Ä¶ (this derivation is complex). Easier method: <span class="math inline">\(I(x) = \text{Tr}(\hat{P}_x |\Psi\rangle\langle\Psi|) = \langle\Psi|\hat{P}_x|\Psi\rangle = ( \psi_1^*\langle m_1| + \psi_2^*\langle m_2| ) (\psi_1|m_1\rangle + \psi_2|m_2\rangle) = |\psi_1|^2\langle m_1|m_1\rangle + |\psi_2|^2\langle m_2|m_2\rangle + \psi_1^*\psi_2 \langle m_1|m_2\rangle + \psi_2^*\psi_1 \langle m_2|m_1\rangle\)</span>. Assuming <span class="math inline">\(|m_p\rangle\)</span> is normalized (<span class="math inline">\(\langle m_p|m_p\rangle=1\)</span>), <span class="math inline">\(I(x) \propto |\psi_1|^2 + |\psi_2|^2 + 2\text{Re}(\mu \psi_1^*\psi_2)\)</span>. If <span class="math inline">\(\mu=0\)</span> (orthogonal markers), the <span class="math inline">\(\psi_1^*\psi_2\)</span> term becomes zero and interference disappears. 2. <span class="math inline">\(I(x|e) \propto |\psi_1(x)\langle e|m_1\rangle + \psi_2(x)\langle e|m_2\rangle|^2\)</span>. The interference term is <span class="math inline">\(2\text{Re}(\psi_1^*\psi_2 \langle m_1|e\rangle \langle e|m_2\rangle)\)</span>. For this term to survive, both <span class="math inline">\(\langle e|m_1\rangle\)</span> and <span class="math inline">\(\langle e|m_2\rangle\)</span> must be non-zero. For maximum interference, <span class="math inline">\(|\langle e|m_1\rangle| = |\langle e|m_2\rangle|\)</span> must hold. 3. BS matrix <span class="math inline">\(U_{BS} = \frac{1}{\sqrt{2}}\begin{pmatrix} 1 &amp; i \\ i &amp; 1 \end{pmatrix}\)</span>, mirror <span class="math inline">\(U_M = \begin{pmatrix} 0 &amp; 1 \\ 1 &amp; 0 \end{pmatrix}\)</span>, phase <span class="math inline">\(U_\phi = \begin{pmatrix} e^{i\phi_1} &amp; 0 \\ 0 &amp; e^{i\phi_2} \end{pmatrix}\)</span>. - Removing BS2: D1 probability is only path 1, D2 probability is only path 2. Each is 50% (independent of phase difference). - Inserting BS2: Calculating <span class="math inline">\(U_{BS} U_\phi U_{BS} |0\rangle\)</span>, D1 probability is <span class="math inline">\(\cos^2(\Delta\phi/2)\)</span>, D2 probability is <span class="math inline">\(\sin^2(\Delta\phi/2)\)</span> (<span class="math inline">\(\Delta\phi = \phi_2-\phi_1+\pi/2\)</span> etc.), showing interference. 4. In delayed choice, ‚ÄòBS2 insertion‚Äô and ‚ÄòBS2 removal‚Äô represent different experimental setups. The <em>total</em> data distributions obtained in each setup differ. In quantum erasure, the <em>total</em> data (including all idler measurement results) always show the same (non-interfering) distribution regardless of the ‚Äòerasure‚Äô setup. The ‚Äòerasure‚Äô measurement merely provides a criterion to classify a subset of this total data at a later stage, without altering already recorded individual photon data. Thus, there is no retrocausality. 5. Bohr‚Äôs complementarity appears contradictory when clinging to the classical picture of ‚Äòwave‚Äô and ‚Äòparticle‚Äô. However, the delayed choice/eraser experiment shows that the ‚Äúoverall setup of the measurement device (Context)‚Äù determines the ‚Äústatistical phenomenon‚Äù we ultimately obtain. The setup with BS2 inserted is designed to produce ‚Äúinterference statistics,‚Äù while the setup with BS2 removed is designed to produce ‚Äúpath statistics.‚Äù What the photon was when passing through BS1 is not important, and the fact that the entire experimental setup (light source, BS1, path, BS2/eraser, detector) acts as an integrated system determining the final statistics is fully compatible with complementarity.</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>