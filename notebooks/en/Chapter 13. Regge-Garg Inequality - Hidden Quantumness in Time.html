<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 13. Leggett-Garg Inequality: Verifying the ‚ÄòClassical History‚Äô in Time ‚Äì Quantum Time &amp; History</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f507c7d0488cb7630e20aad62ad8c2aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>window.MathJax = {loader: {load: ['[tex]/boldsymbol']},tex: {packages: {'[+]': ['boldsymbol']}}};</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html">Chapters</a></li><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 13. Regge-Garg Inequality - Hidden Quantumness in Time.html">13. Regge-Garg Inequality</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">English</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Language</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index_en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">English</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ÌïúÍµ≠Ïñ¥</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/0. Table of Contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table of Contents</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Hilbert Space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 2. Coupling and State of Quantum Systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Coupling and State of Quantum Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 3. Symmetry Group and Generator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Symmetry Group and Generator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 4. Action Functional and Variational Euler-Lagrange Equation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Action</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 5. Path Integral Axiomatization Functional Integral Symbol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Path Integral</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 6. Dynamics of Open Quantum Systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Dynamics of Open Quantum Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 7. Consistency_History and Quantum_Probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Consistency History</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 8. Natural Selection and Quantum Eraser.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Natural Selection and Quantum Eraser</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 9. Quantum Pluralism How is Objective Reality Born?.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Quantum Pluralism</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 10. Emergent Time - Flow of Time in a Frozen Universe Page-Wootters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Emergent Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 11. C-von_Neumann_Operator_Algebra_Thermal_Time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Thermal_Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 12. Uncertain Causal Order.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Uncertain Causal Order</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/Chapter 13. Regge-Garg Inequality - Hidden Quantumness in Time.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">13. Regge-Garg Inequality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/en/14. Appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Appendix</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fundamental-concepts" id="toc-fundamental-concepts" class="nav-link active" data-scroll-target="#fundamental-concepts">1. Fundamental Concepts</a></li>
  <li><a href="#symbols-and-key-relations" id="toc-symbols-and-key-relations" class="nav-link" data-scroll-target="#symbols-and-key-relations">2. Symbols and Key Relations</a></li>
  <li><a href="#examples-with-deeper-insight" id="toc-examples-with-deeper-insight" class="nav-link" data-scroll-target="#examples-with-deeper-insight">3. Examples with Deeper Insight</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">4. Exercises</a></li>
  <li><a href="#explanation" id="toc-explanation" class="nav-link" data-scroll-target="#explanation">5. Explanation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 1. Hilbert Space and Inner Product Operator Theory.html">Chapters</a></li><li class="breadcrumb-item"><a href="../../notebooks/en/Chapter 13. Regge-Garg Inequality - Hidden Quantumness in Time.html">13. Regge-Garg Inequality</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Chapter 13. Leggett-Garg Inequality: Verifying the ‚ÄòClassical History‚Äô in Time</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We believe that the moon remains suspended in the sky even when we cannot see it. Furthermore, we think that merely looking at the moon does not alter its orbit. In this way, our common-sense worldview that ‚Äúthe world exists independently of observation, and ideal measurements do not disturb the future‚Äù is called <strong>Macrorealism</strong>.</p>
<p>The <strong>Leggett-Garg Inequality (LGI)</strong> represents the mathematical limitations that this classical intuition must satisfy.</p>
<p>Surprisingly, quantum systems can violate this inequality. This demonstrates that the peculiar nature of quantum mechanics is not confined to space (Bell inequality), but also exists within <strong>time (LGI)</strong>. LGI provides an experimental answer to the question: ‚ÄúDoes the system indeed have a clear ‚Äòhistory‚Äô even when we are not observing it?‚Äù</p>
<section id="fundamental-concepts" class="level3">
<h3 class="anchored" data-anchor-id="fundamental-concepts">1. Fundamental Concepts</h3>
<ul>
<li><p><strong>Macrorealism (MR)</strong>: Two key assumptions that constitute our classical intuition.</p>
<ol type="1">
<li><strong>Macrorealism-per-se</strong>: Any physical quantity (e.g., the position of a pendulum) always has a clearly defined value (<span class="math inline">\(+1\)</span> or <span class="math inline">\(-1\)</span>) regardless of whether we measure it or not.</li>
<li><strong>Non-Invasive Measurability (NIM)</strong>: In principle, it is possible to measure the value of a physical quantity without disturbing the system‚Äôs state after the measurement.</li>
</ol></li>
<li><p><strong>Leggett-Garg Inequality (LGI)</strong>: If the two classical assumptions above are correct, a theorem states that the correlation between physical quantities measured at different times cannot exceed a specific mathematical boundary (inequality). The most representative form is as follows. <span class="math inline">\(K_3 = C_{12} + C_{23} - C_{13} \le 1\)</span></p>
<ul>
<li>Here, <span class="math inline">\(C_{ij} = \langle Q(t_i) Q(t_j) \rangle\)</span> represents the correlation between measurement values at time <span class="math inline">\(t_i\)</span> and <span class="math inline">\(t_j\)</span>.</li>
</ul></li>
<li><p><strong>Temporal Non-Locality</strong>: The phenomenon where quantum systems violate LGI. This implies that quantum systems do not follow a clearly defined ‚Äòhistory‚Äô (violating MR), or that measurement actions fundamentally disturb future states (violating NIM). This reveals a ‚Äòghostly connection‚Äô in the <strong>temporal history</strong> of a single system. ‚è∞</p>
<blockquote class="blockquote">
<p><strong>üí° Connection Between LGI and Consistent Histories (Chapter 6)</strong></p>
<p>As learned in Chapter 6, ‚Äòconsistent histories‚Äô can only assign classical probabilities to histories when <span class="math inline">\(D(\alpha, \beta)=0\)</span>.</p>
<p>The ‚ÄòMacrorealism (MR)‚Äô assumed by LGI claims that ‚Äúthe system already has the values <span class="math inline">\((Q_1, Q_2, Q_3)\)</span> at times <span class="math inline">\(t_1, t_2, t_3\)</span>‚Äù. This is a very strong assumption that all eight (<span class="math inline">\(2^3\)</span>) classical histories are consistent (i.e., have zero interference).</p>
<p>The violation of LGI experimentally shows that these classical histories do not possess ‚Äòconsistency‚Äô in quantum mechanics (<span class="math inline">\(D(\alpha, \beta) \neq 0\)</span>), thus demonstrating that the concept of a ‚Äúpre-determined history‚Äù does not hold.</p>
</blockquote></li>
<li><p><strong>Clumsiness Loophole</strong>: The greatest challenge when experimentally testing LGI violations. When an LGI violation is observed, it is difficult to distinguish whether it is due to a genuine quantum phenomenon or because we have ‚Äòclumsily‚Äô measured, thereby disturbing the system (i.e., violating the NIM assumption). &gt; <strong>üç≥ Detailed Explanation: What is the ‚ÄúSutton‚Äôs Trap‚Äù?</strong> &gt; &gt; Let‚Äôs assume that the egg on the pan is in the state where the yolk has not burst (<span class="math inline">\(Q=+1\)</span>). &gt; &gt; 1. <strong><span class="math inline">\(t_1\)</span></strong>: When pressed slightly with a fork, it did not burst (<span class="math inline">\(Q(t_1)=+1\)</span>). (First measurement) &gt; 2. <strong><span class="math inline">\(t_2\)</span></strong>: However, the act of pressing caused a crack in the yolk. (Disturbance occurred) &gt; 3. <strong><span class="math inline">\(t_3\)</span></strong>: When pressed again, the yolk burst (<span class="math inline">\(Q(t_3)=-1\)</span>). &gt; &gt; This experimenter concludes, ‚ÄúAt <span class="math inline">\(t_1\)</span> it was <span class="math inline">\(+1\)</span>, but at <span class="math inline">\(t_3\)</span> it became <span class="math inline">\(-1\)</span>.‚Äù However, this result is not because the egg itself changed, but because the ‚Äúclumsy measurement‚Äù at <span class="math inline">\(t_1\)</span> contaminated the result at <span class="math inline">\(t_3\)</span>. LGI violation experiments must exclude the possibility of this ‚Äúclumsy measurement‚Äù to truly prove quantum behavior.</p></li>
<li><p><strong>Trap Avoidance Strategies</strong>: To avoid this Sutton‚Äôs trap, clever methods that ensure ‚Äúmeasured but undisturbed‚Äù have been devised.</p>
<ul>
<li><strong>Ideal Negative Result Measurement</strong>: A detector that only clicks when the system is in the <span class="math inline">\(|+1\rangle\)</span> state is used. If no sound is heard, we learn that the system is in the <span class="math inline">\(|-1\rangle\)</span> state without any interaction.</li>
<li><strong>Weak Measurement</strong>: The system is measured very weakly, causing minimal disturbance, and instead, the signal is obtained by repeating the measurement countless times statistically.</li>
<li><strong>NSIT (No-Signaling-In-Time)</strong>: It is statistically proven through separate control experiments that the measurement at <span class="math inline">\(t_1\)</span> does not affect the statistics at <span class="math inline">\(t_2\)</span>.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="symbols-and-key-relations" class="level3">
<h3 class="anchored" data-anchor-id="symbols-and-key-relations">2. Symbols and Key Relations</h3>
<ul>
<li><strong>Observables and Correlation Functions</strong>:
<ul>
<li>Measurement value: <span class="math inline">\(Q(t_k) \in \{+1, -1\}\)</span> (e.g., spin up/down)</li>
<li>Two-time correlation function: <span class="math inline">\(C_{ij} = \langle Q(t_i) Q(t_j) \rangle = \sum_{Q_i, Q_j} Q_i Q_j P(Q_i, Q_j)\)</span></li>
</ul></li>
<li><strong>LGI Inequality (K3 Form)</strong>:
<ul>
<li>Classical assumption (MR + NIM) <span class="math inline">\(\implies\)</span> <span class="math inline">\(K_3 = C_{12} + C_{23} - C_{13} \le 1\)</span></li>
</ul>
<blockquote class="blockquote">
<p><strong>üí° Why should this inequality hold? (Simple Proof)</strong></p>
<p>Under the classical assumption (MR), the particle has a value <span class="math inline">\((Q_1, Q_2, Q_3)\)</span> simultaneously at the three times <span class="math inline">\(t_1, t_2, t_3\)</span>. Each <span class="math inline">\(Q_k\)</span> is either <span class="math inline">\(+1\)</span> or <span class="math inline">\(-1\)</span>.</p>
<p>Let‚Äôs calculate <span class="math inline">\((Q_1 Q_2 + Q_2 Q_3 - Q_1 Q_3)\)</span> for any combination. (e.g., <span class="math inline">\((+1,+1,+1) \to 1+1-1=1\)</span>; <span class="math inline">\((+1,-1,+1) \to -1-1-1=-3 \le 1\)</span>)</p>
Grouping by <span class="math inline">\(Q_2\)</span>, it becomes <span class="math inline">\(Q_2(Q_1+Q_3) - Q_1 Q_3\)</span>.
<ul>
<li>If <span class="math inline">\(Q_1=Q_3\)</span> (both <span class="math inline">\(+1\)</span> or both <span class="math inline">\(-1\)</span>): <span class="math inline">\(Q_2(\pm 2) - (\pm 1) = \pm 2 Q_2 - 1\)</span>. Whether <span class="math inline">\(Q_2\)</span> is <span class="math inline">\(+1\)</span> or <span class="math inline">\(-1\)</span>, this value is either <span class="math inline">\(1\)</span> or <span class="math inline">\(-3\)</span>.</li>
<li>If <span class="math inline">\(Q_1 \neq Q_3\)</span> (one is <span class="math inline">\(+1\)</span>, one is <span class="math inline">\(-1\)</span>): <span class="math inline">\(Q_2(0) - (-1) = 1\)</span>.</li>
</ul>
<p>That is, <strong>for any individual history, <span class="math inline">\(Q_1 Q_2 + Q_2 Q_3 - Q_1 Q_3 \le 1\)</span> always holds</strong>.</p>
<p>Therefore, the average of these values, <span class="math inline">\(C_{12} + C_{23} - C_{13}\)</span>, must also not exceed <span class="math inline">\(1\)</span>.</p>
</blockquote></li>
<li><strong>Quantum Violation</strong>:
<ul>
<li>In quantum mechanics, <span class="math inline">\(Q(t_1)\)</span> and <span class="math inline">\(Q(t_2)\)</span> may not simultaneously have definite values (MR violation).</li>
<li>Additionally, the measurement of <span class="math inline">\(Q(t_1)\)</span> (e.g., <span class="math inline">\(\sigma_z\)</span> measurement) can fundamentally change the state of <span class="math inline">\(Q(t_2)\)</span> (NIM violation).</li>
<li>A quantum system can reach up to <strong>1.5 (L√ºders Bound)</strong>, which clearly violates the classical limit of 1.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="examples-with-deeper-insight" class="level3">
<h3 class="anchored" data-anchor-id="examples-with-deeper-insight">3. Examples with Deeper Insight</h3>
<ul>
<li><strong>Example 1: Classical System (LGI Satisfied)</strong>
<ul>
<li><strong>Situation</strong>: A classical Markov process randomly oscillating between <span class="math inline">\(+1\)</span> and <span class="math inline">\(-1\)</span> (e.g., a process where coin flip results gradually fade).</li>
<li><strong>Correlation</strong>: <span class="math inline">\(C_{ij} \approx e^{-\gamma|t_i-t_j|}\)</span> (correlation decreases exponentially as time separates).</li>
<li><strong>Result</strong>: <span class="math inline">\(K_3 = e^{-\gamma \tau} + e^{-\gamma \tau} - e^{-2\gamma \tau} = 2e^{-\gamma \tau} - e^{-2\gamma \tau}\)</span>. (Here, <span class="math inline">\(\tau = t_2-t_1 = t_3-t_2\)</span>)</li>
<li><strong>Interpretation</strong>: Let <span class="math inline">\(x = e^{-\gamma \tau}\)</span>, then <span class="math inline">\(2x - x^2 = 1 - (1-x)^2\)</span>. Since <span class="math inline">\(x\)</span> is between 0 and 1, <span class="math inline">\((1-x)^2 \ge 0\)</span>, and therefore <span class="math inline">\(K_3 \le 1\)</span>. A classical system never violates LGI.</li>
</ul></li>
<li><strong>Example 2: Quantum Qubit (LGI Violation)</strong>
<ul>
<li><strong>Situation</strong>: A spin undergoing precession in a magnetic field along the <span class="math inline">\(x\)</span>-axis.
<ul>
<li>Hamiltonian: <span class="math inline">\(H = \frac{\hbar\Omega}{2} \sigma_x\)</span> (spin rotates in the <span class="math inline">\(y-z\)</span> plane at speed <span class="math inline">\(\Omega\)</span>)</li>
<li>Observable: <span class="math inline">\(Q = \sigma_z\)</span> (spin measurement along the <span class="math inline">\(z\)</span>-axis)</li>
</ul></li>
<li><strong>Correlation</strong>: (Assuming ideal measurements) the expected value of measuring <span class="math inline">\(\sigma_z\)</span> at <span class="math inline">\(t_i\)</span>, evolving until <span class="math inline">\(t_j\)</span>, and measuring <span class="math inline">\(\sigma_z\)</span> again is <span class="math inline">\(C_{ij} = \cos(\Omega(t_j-t_i))\)</span>.</li>
<li><strong>Result</strong>: When measured at equal intervals <span class="math inline">\(\tau\)</span>, <span class="math inline">\(K_3 = \cos(\Omega\tau) + \cos(\Omega\tau) - \cos(2\Omega\tau) = 2\cos(\Omega\tau) - \cos(2\Omega\tau)\)</span>.</li>
<li><strong>Violation</strong>: If <span class="math inline">\(\Omega\tau = \pi/3\)</span> (<span class="math inline">\(60^\circ\)</span> rotation) is set, <span class="math inline">\(K_3 = 2\cos(60^\circ) - \cos(120^\circ) = 2(0.5) - (-0.5) = 1 + 0.5 = \mathbf{1.5}\)</span>. This clearly violates the classical limit of 1.</li>
</ul></li>
<li><strong>Example 3: Effect of Decoherence (Process of Losing Quantumness)</strong>
<ul>
<li><strong>Situation</strong>: The qubit from Example 2 interacting with the environment and losing quantum coherence.</li>
<li><strong>Correlation</strong>: <span class="math inline">\(C_{ij} \approx e^{-\Gamma|t_i-t_j|} \cos(\Omega(t_j-t_i))\)</span> (correlation additionally damps).</li>
<li><strong>Result</strong>: The <span class="math inline">\(K_3\)</span> value becomes smaller than 1.5. If decoherence (<span class="math inline">\(\Gamma\)</span>) is sufficiently strong, the <span class="math inline">\(K_3\)</span> value drops below 1, and the system behaves classically again. This illustrates how ‚Äúdecoherence,‚Äù learned in Chapter 5 (Open Systems) and Chapter 8 (Quantum Darwinism), suppresses LGI violation (quantumness) and ‚Äúemerges‚Äù classical realism.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">4. Exercises</h3>
<ol type="1">
<li><strong>(Proof of LGI <span class="math inline">\(K_3 \le 1\)</span>)</strong>: As explained in the <code>üí°</code> box of Section 2 of the main text, directly verify that for all 8 combinations of <span class="math inline">\((\pm 1, \pm 1, \pm 1)\)</span> of <span class="math inline">\((Q_1, Q_2, Q_3)\)</span>, the inequality <span class="math inline">\(Q_1 Q_2 + Q_2 Q_3 - Q_1 Q_3 \le 1\)</span> holds.</li>
<li><strong>(Derivation of Quantum Bit <span class="math inline">\(K_3\)</span>)</strong>: Show how <span class="math inline">\(C_{12} = \cos(\Omega\tau)\)</span> is derived in the quantum bit system of Example 2 using the Heisenberg picture (operator evolution). (Hint: You need to compute <span class="math inline">\(Q(t) = \sigma_z(t) = e^{iHt/\hbar} \sigma_z(0) e^{-iHt/\hbar}\)</span>.)</li>
<li><strong>(Finding Maximum Violation)</strong>: Differentiate <span class="math inline">\(K_3(\tau) = 2\cos(\Omega\tau) - \cos(2\Omega\tau)\)</span> with respect to <span class="math inline">\(\tau\)</span>, and show that the condition for <span class="math inline">\(K_3\)</span> to be maximum is <span class="math inline">\(\Omega\tau = \pi/3\)</span>.</li>
<li><strong>(<span class="math inline">\(K_4\)</span> Inequality)</strong>: Prove that under classical assumptions (MR+NIM), for four time points <span class="math inline">\(t_1 &lt; t_2 &lt; t_3 &lt; t_4\)</span>, the inequality <span class="math inline">\(K_4 = C_{12} + C_{23} + C_{34} - C_{14} \le 2\)</span> holds.</li>
<li><strong>(Design of NSIT Protocol)</strong>: Explain how to design an NSIT test that compares an experimental protocol obtaining the measurement statistics <span class="math inline">\(P(Q_2)\)</span> at <span class="math inline">\(t_2\)</span> with a protocol obtaining the measurement statistics <span class="math inline">\(P'(Q_2)\)</span> at <span class="math inline">\(t_2\)</span> after performing a measurement at <span class="math inline">\(t_1\)</span>.</li>
</ol>
<hr>
</section>
<section id="explanation" class="level3">
<h3 class="anchored" data-anchor-id="explanation">5. Explanation</h3>
<ol type="1">
<li>(Example) <span class="math inline">\(Q_1=1, Q_2=-1, Q_3=-1\)</span> then <span class="math inline">\(Q_1Q_2 + Q_2Q_3 - Q_1Q_3 = (1)(-1) + (-1)(-1) - (1)(-1) = -1 + 1 + 1 = 1 \le 1\)</span>. The other 7 cases also yield 1 or -1.<br>
</li>
<li>(Heisenberg description) <span class="math inline">\(H=\frac{\hbar\Omega}{2}\sigma_x\)</span>. The exponential function <span class="math inline">\(e^{i\frac{\Omega t}{2}\sigma_x} = \cos(\frac{\Omega t}{2})\mathbf{1} + i\sin(\frac{\Omega t}{2})\sigma_x\)</span>.<br>
<span class="math inline">\(\sigma_z(t) = e^{iHt/\hbar} \sigma_z(0) e^{-iHt/\hbar} = (\cos + i\sin\sigma_x) \sigma_z (\cos - i\sin\sigma_x)\)</span><br>
<span class="math inline">\(= (\cos\sigma_z - i\sin\sigma_z\sigma_x) (\cos - i\sin\sigma_x) = (\cos\sigma_z + \sin\sigma_y) (\cos - i\sin\sigma_x)\)</span><br>
<span class="math inline">\(= \cos^2\sigma_z + \sin\cos\sigma_y - i\cos\sin\sigma_z\sigma_x - i\sin^2\sigma_y\sigma_x\)</span><br>
<span class="math inline">\(= \cos^2\sigma_z + \sin\cos\sigma_y - i\sin\cos(i\sigma_y) - \sin^2(-i\sigma_z) = \cos^2\sigma_z + 2\sin\cos\sigma_y + \sin^2\sigma_z = \cos(2\frac{\Omega t}{2})\sigma_z + \sin(2\frac{\Omega t}{2})\sigma_y = \cos(\Omega t)\sigma_z + \sin(\Omega t)\sigma_y\)</span>.<br>
<span class="math inline">\(C_{12} = \langle \sigma_z(\tau) \sigma_z(0) \rangle = \langle (\cos(\Omega\tau)\sigma_z + \sin(\Omega\tau)\sigma_y) \sigma_z \rangle = \cos(\Omega\tau) \langle \sigma_z^2 \rangle + \sin(\Omega\tau) \langle \sigma_y \sigma_z \rangle\)</span>.<br>
<span class="math inline">\(\langle \sigma_z^2 \rangle = \langle \mathbf{1} \rangle = 1\)</span> and (assuming the initial state <span class="math inline">\(\rho_0\)</span> is symmetric about the <span class="math inline">\(z\)</span>-axis) <span class="math inline">\(\langle \sigma_y \sigma_z \rangle = \langle i\sigma_x \rangle = 0\)</span>. Therefore, <span class="math inline">\(C_{12} = \cos(\Omega\tau)\)</span>. <span class="math inline">\(C_{13}\)</span> is identical by replacing <span class="math inline">\(\tau \to 2\tau\)</span>.<br>
</li>
<li><span class="math inline">\(dK_3/d\tau = -2\Omega\sin(\Omega\tau) + 2\Omega\sin(2\Omega\tau) = 0\)</span>. <span class="math inline">\(\sin(2\Omega\tau) = \sin(\Omega\tau) \implies 2\sin(\Omega\tau)\cos(\Omega\tau) = \sin(\Omega\tau)\)</span>. <span class="math inline">\(\sin(\Omega\tau)=0\)</span> (minimum) or <span class="math inline">\(\cos(\Omega\tau)=1/2\)</span>. When <span class="math inline">\(\cos(\Omega\tau)=1/2\)</span>, <span class="math inline">\(\Omega\tau = \pi/3\)</span>, and at this point <span class="math inline">\(K_3=1.5\)</span> is maximum.<br>
</li>
<li><span class="math inline">\(K_4 = Q_1Q_2 + Q_2Q_3 + Q_3Q_4 - Q_1Q_4\)</span>.<br>
It can be grouped as <span class="math inline">\(Q_2(Q_1+Q_3) + Q_4(Q_3-Q_1)\)</span>. Checking all possible combinations (16 cases), the maximum is 2. (Example: <span class="math inline">\(1,1,1,-1 \to 1+1-1-(-1)=2\)</span>).<br>
</li>
<li>(Protocol A) Prepare many identical systems and perform measurements only at <span class="math inline">\(t_2\)</span>, obtaining <span class="math inline">\(P(Q_2)\)</span>. (Protocol B) Prepare identical systems and perform a measurement at <span class="math inline">\(t_1\)</span> (whether recording the result or not), and also perform a measurement at <span class="math inline">\(t_2\)</span> to obtain <span class="math inline">\(P'(Q_2)\)</span>. If <span class="math inline">\(P(Q_2)\)</span> and <span class="math inline">\(P'(Q_2)\)</span> show a statistically significant difference, the measurement at <span class="math inline">\(t_1\)</span> has disturbed the statistics at <span class="math inline">\(t_2\)</span>, indicating that NSIT has failed (i.e., Sutum‚Äôs trap remains open).</li>
<li>(Example) If <span class="math inline">\(Q_1=1, Q_2=-1, Q_3=-1\)</span>, then <span class="math inline">\(Q_1Q_2 + Q_2Q_3 - Q_1Q_3 = (1)(-1) + (-1)(-1) - (1)(-1) = -1 + 1 + 1 = 1 \le 1\)</span>. All other 7 cases also result in 1 or -1. 2. (Heisenberg description) <span class="math inline">\(H=\frac{\hbar\Omega}{2}\sigma_x\)</span>. Exponential function <span class="math inline">\(e^{i\frac{\Omega t}{2}\sigma_x} = \cos(\frac{\Omega t}{2})\mathbf{1} + i\sin(\frac{\Omega t}{2})\sigma_x\)</span>. <span class="math inline">\(\sigma_z(t) = e^{iHt/\hbar} \sigma_z(0) e^{-iHt/\hbar} = (\cos + i\sin\sigma_x) \sigma_z (\cos - i\sin\sigma_x)\)</span> <span class="math inline">\(= (\cos\sigma_z - i\sin\sigma_z\sigma_x) (\cos - i\sin\sigma_x) = (\cos\sigma_z + \sin\sigma_y) (\cos - i\sin\sigma_x)\)</span> <span class="math inline">\(= \cos^2\sigma_z + \sin\cos\sigma_y - i\cos\sin\sigma_z\sigma_x - i\sin^2\sigma_y\sigma_x\)</span> <span class="math inline">\(= \cos^2\sigma_z + \sin\cos\sigma_y - i\sin\cos(i\sigma_y) - \sin^2(-i\sigma_z) = \cos^2\sigma_z + 2\sin\cos\sigma_y + \sin^2\sigma_z = \cos(2\frac{\Omega t}{2})\sigma_z + \sin(2\frac{\Omega t}{2})\sigma_y = \cos(\Omega t)\sigma_z + \sin(\Omega t)\sigma_y\)</span>. <span class="math inline">\(C_{12} = \langle \sigma_z(\tau) \sigma_z(0) \rangle = \langle (\cos(\Omega\tau)\sigma_z + \sin(\Omega\tau)\sigma_y) \sigma_z \rangle = \cos(\Omega\tau) \langle \sigma_z^2 \rangle + \sin(\Omega\tau) \langle \sigma_y \sigma_z \rangle\)</span>. <span class="math inline">\(\langle \sigma_z^2 \rangle = \langle \mathbf{1} \rangle = 1\)</span> and, (assuming the initial state <span class="math inline">\(\rho_0\)</span> is symmetric around the z-axis) <span class="math inline">\(\langle \sigma_y \sigma_z \rangle = \langle i\sigma_x \rangle = 0\)</span>. Therefore <span class="math inline">\(C_{12} = \cos(\Omega\tau)\)</span>. <span class="math inline">\(C_{13}\)</span> is the same with <span class="math inline">\(\tau \to 2\tau\)</span>. 3. <span class="math inline">\(dK_3/d\tau = -2\Omega\sin(\Omega\tau) + 2\Omega\sin(2\Omega\tau) = 0\)</span>. <span class="math inline">\(\sin(2\Omega\tau) = \sin(\Omega\tau) \implies 2\sin(\Omega\tau)\cos(\Omega\tau) = \sin(\Omega\tau)\)</span>. <span class="math inline">\(\sin(\Omega\tau)=0\)</span> (minimum) or <span class="math inline">\(\cos(\Omega\tau)=1/2\)</span>. When <span class="math inline">\(\cos(\Omega\tau)=1/2\)</span>, <span class="math inline">\(\Omega\tau = \pi/3\)</span>, and at this point <span class="math inline">\(K_3=1.5\)</span> is maximum. 4. <span class="math inline">\(K_4 = Q_1Q_2 + Q_2Q_3 + Q_3Q_4 - Q_1Q_4\)</span>. It can be grouped as <span class="math inline">\(Q_2(Q_1+Q_3) + Q_4(Q_3-Q_1)\)</span>. Checking all possible combinations (16 cases), the maximum is 2. (Example: <span class="math inline">\(1,1,1,-1 \to 1+1-1-(-1)=2\)</span>). 5. (Protocol A) Prepare many identical systems and perform measurements only at <span class="math inline">\(t_2\)</span> to obtain <span class="math inline">\(P(Q_2)\)</span>. (Protocol B) Prepare the same system and perform measurements at <span class="math inline">\(t_1\)</span> (recording the results or not), and perform measurements at <span class="math inline">\(t_2\)</span> to obtain <span class="math inline">\(P'(Q_2)\)</span>. If <span class="math inline">\(P(Q_2)\)</span> and <span class="math inline">\(P'(Q_2)\)</span> show a statistically significant difference, it means that the measurement at <span class="math inline">\(t_1\)</span> disturbed the statistics at <span class="math inline">\(t_2\)</span>, indicating that NSIT failed (i.e., the trap was not closed).</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>